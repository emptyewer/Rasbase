(function() {	// getElementById	function $id(id) {		return document.getElementById(id);	}	function formatBytes(bytes,decimals) {   if(bytes == 0) return '0 Bytes';   var k = 1000,       dm = decimals + 1 || 3,       sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],       i = Math.floor(Math.log(bytes) / Math.log(k));   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];	}	// file drag hover	function FileDragHover(e) {		e.stopPropagation();		e.preventDefault();		e.target.className = (e.type == "dragover" ? "hover" : "");		$("#drop_well").addClass("well-hover text-muted text-center");	}	// file selection	function FileDropHandler(e) {		// cancel event and hover styling		FileDragHover(e);		// fetch FileList object		var files = e.dataTransfer.files;		if (files[0].type == "application/json") {			$("#drop_well").html("<i class='fa fa-refresh fa-spin' style='font-size: 4rem'></i><h3>Uploading</h3>");			ShowFileInfo(files[0], 1);			DisplayResults(files[0]);    }    else {			ShowFileInfo(files[0], 0);			RestoreHover();		}	}	function HideShowHouseKeeping() {		$("#footer-panel").fadeOut();		$("#drop_well").fadeOut();		$("#import-table-well").fadeIn().show();  }  function RestoreHover() {		$("#drop_well").removeClass("well-hover text-muted text-center");		$("#drop_well").addClass("well text-muted text-center");		$("#drop_well_icon").removeClass("fa fa-upload");		$("#drop_well_icon").addClass("fa fa-upload");	}	// output file information	function ShowFileInfo(file, tag) {		if (tag == 1) {			$("#import-table-header").html("Reading from file: <strong>" + file.name + "</strong>");      var text = "File: <strong>" + file.name +        "</strong> of type: <strong>" + file.type +        "</strong> size: <strong>" + formatBytes(file.size) +        "</strong>";      $("#topalert").html(text);      $("#topalert").removeClass("alert alert-danger");      $("#topalert").addClass("alert alert-success");      $("#topalert").show().delay(5000).fadeOut();    }    else {			var text = "<strong>Only .json files are accepted for upload.</strong>";      $("#topalert").html(text);      $("#topalert").removeClass("alert alert-success");      $("#topalert").addClass("alert alert-danger");      $("#topalert").show().delay(5000).fadeOut();		}	}	function truncate(n, len) {      var ext = n.substring(n.lastIndexOf(".") + 1, n.length).toLowerCase();      var filename = n.replace('.'+ext,'');      if(filename.length <= len) {          return n;      }      filename = filename.substr(0, len) + (n.length > len ? '..' : '');      return filename;  };	function return_na(value) {		if (value == '-1') {			return "N/A";		}		else {			return value;		}	}	function DisplayResults(file) {    var reader = new FileReader();		reader.onload = function() {				//reader.result,				console.log(reader.result.length);		};		reader.onerror = function() {				alert("Could not read the file");				CancelledHandler();		};		reader.onprogress = function(file) {			if (file.lengthComputable) {					var progress = parseInt(((file.loaded / file.total) * 100), 10);					console.log(progress);					// document.getElementById('label').innerHTML = progress;			}		};		reader.onloadend = function () {			HideShowHouseKeeping();			RestoreHover();			text = JSON.parse(reader.result);			json_string = JSON.stringify(text); //.replace(/"/g, "'");				$("#hidden-entries").append("<input type='hidden' name='data' value=\"" + json_string + "\">");				for (var key in text.genes) {					var item = text.genes[key]['stats'];    			$("#import-table tbody").append("<tr><td>" + key + "</td>" +						"<td>" + item[0] + "</td>" +						"<td>" + item[1] + "</td>" +						"<td>" + item[2] + "</td>" +						"<td>" + item[3] + "</td>" +						"<td>" + item[5] + "</td>" +						"</tr>");    			var item = text.genes[key]['selected']['bait']['junction_stats'];    			$("#bait-sel-junctions-table tbody").append("<tr><td>" + truncate(key, 5) + "</td>" +						"<td>" + return_na(item[0]) + "</td>" +						"<td>" + return_na(item[1]) + "</td>" +						"<td>" + return_na(item[2]) + "</td>" +						"<td>" + return_na(item[3]) + "</td>" +						"<td>" + return_na(item[4]) + "</td>" +						"<td>" + return_na(item[5]) + "</td>" +						"</tr>");    			var item = text.genes[key]['non_selected']['bait']['junction_stats'];    			$("#bait-nonsel-junctions-table tbody").append("<tr><td>" + truncate(key, 5) + "</td>" +						"<td>" + return_na(item[0]) + "</td>" +						"<td>" + return_na(item[1]) + "</td>" +						"<td>" + return_na(item[2]) + "</td>" +						"<td>" + return_na(item[3]) + "</td>" +						"<td>" + return_na(item[4]) + "</td>" +						"<td>" + return_na(item[5]) + "</td>" +						"</tr>");				}				$("#vector1s").html(text.files['selected']['vector1']);				$("#vector2s").html(text.files['selected']['vector2']);				$("#vector1n").html(text.files['non_selected']['vector1']);				$("#vector2n").html(text.files['non_selected']['vector2']);				$("#bait1s").html(text.files['selected']['bait']);				$("#bait1n").html(text.files['non_selected']['bait']);				$("#threshold").html(text.files['threshold'] + ' (ppm)');				$('#import-table').DataTable({					"order": [[ 5, 'dsc' ]],					responsive: true				});				$('#bait-sel-junctions-table').DataTable({					responsive: true,					"lengthChange": false,					"info": false,					"pagingType": "simple",					"compact":true,					"searching": false,					"ordering": false				});				$('#bait-sel-junctions-table_length label').hide();				$('#bait-nonsel-junctions-table').DataTable({					responsive: true,					"lengthChange": false,					"info": false,					"pagingType": "simple",					"searching": false,					"ordering": false				});				$('#bait-nonsel-junctions-table_length label').hide();				$('#bait-sel-junctions-table_paginate').addClass('text-right');				$('#bait-sel-junctions-table_filter').addClass('text-right');				$('#bait-nonsel-junctions-table_paginate').addClass('text-right');				$('#bait-nonsel-junctions-table_filter').addClass('text-right');				$('#import-table_paginate').addClass('text-right');				$('#import-table_filter').addClass('text-right');    };		reader.readAsText(file);	}	function CancelledHandler() {		console.log("Cancelled");		location.reload();  }	// initialize	function Init() {		var filedrag = $id("drop_well");		var cancelbutton = $id("cancel-button");		// file select		cancelbutton.addEventListener("click", CancelledHandler, false);		// is XHR2 available?		var xhr = new XMLHttpRequest();		if (xhr.upload) {			// file drop			filedrag.addEventListener("dragover", FileDragHover, false);			filedrag.addEventListener("dragleave", FileDragHover, false);			filedrag.addEventListener("drop", FileDropHandler, false);			filedrag.style.display = "block";			// remove submit button			// submitbutton.style.display = "none";		}	}	// call initialization file	if (window.File && window.FileList && window.FileReader) {		Init();		$("#import-table-well").hide();		$("#pbar").hide();		$("#topalert").hide();	}})();